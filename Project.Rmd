---
title: "Regression Models Project"
author: "Mehdi HAMDOUNE"
date: "3/24/2021"
output:
  prettydoc::html_pretty:
    theme: cayman
  pdf_document: default
---

## **Introduction**

We Look at a data set of a collection of cars (mtcars), we are interested in exploring the relationship between a set of variables and miles per gallon (MPG) (outcome). we are particularly interested in the following two questions:

“Is an automatic or manual transmission better for MPG”
"Quantify the MPG difference between automatic and manual transmissions"

The variables included in this dataset are:

- mpg :	Miles/(US) gallon
- cyl	: Number of cylinders
- disp :	Displacement (cu.in.)
- hp : Gross horsepower
- drat :	Rear axle ratio
- wt :	Weight (1000 lbs)
- qsec :	1/4 mile time
- vs :	Engine (0 = V-shaped, 1 = straight)
- am :	Transmission (0 = automatic, 1 = manual)
- gear :	Number of forward gears


## **Loading and preprocessing the data**

```{r,  warning = FALSE, message = FALSE } 

setwd("D:/Auto_formation/Coursera_Regression_Models/Project")

# Importing The Librairies

library(plyr)
library(tidyr)
library(dplyr)
library(ggplot2)
library(ggpubr)


data("mtcars")

```

```{r,  warning = FALSE, message = FALSE } 
head(mtcars)
```

```{r,  warning = FALSE, message = FALSE } 
str(mtcars)
```


```{r,  warning = FALSE, message = FALSE } 
sum(is.na(mtcars))
```
## **Analysis**

#### *Running t-test*

```{r,  warning = FALSE, message = FALSE } 
atData<-mtcars[mtcars$am == 0,]
mtData<-mtcars[mtcars$am == 1,]
t.test(atData$mpg, mtData$mpg)
``` 


#### *Barplot of the miles per galon by Transmission*
 
```{r,  warning = FALSE, message = FALSE } 
mtcars$am <- as.factor(mtcars$am) 

# Box plot
g <- ggboxplot(mtcars, x = "am", y = "mpg",
    color = "deepskyblue4", palette = "jco") +
  labs(title="barplot of the miles per galon by Transmission", x= "Transmission", 
       y = "Miles Per Galon") + 
  theme(plot.title = element_text(hjust = 0.5))

g
``` 

From this barplot we can assume that there is a significant association between Miles Per Galon and Transmission.
 

#### *Correlations*

```{r,  warning = FALSE, message = FALSE } 

corr <- select(mtcars, mpg,cyl,disp,wt,qsec, am)
pairs(corr)

```


## **Linear Models**

#### Choosing The Predictors 

```{r,  warning = FALSE, message = FALSE } 

fit <- step(lm(data = mtcars, mpg ~ .),trace=0,steps=10000)
summary(fit)

```
This model uses a step algorithm to pick the variables that affect the mpg of cars the most. From the model, the weight, acceleration as well as the transmission mode affect the mpg of the car the most.

Based on this multivariate regression model, a manual transmission car has a fuel efficiency of 2.94 MPG higher than that of automatic transmission cars. The adjusted R^2 of the model is 0.834, meaning that 83% of the variance in mpg can be explained by the model.

#### *2nd Model*

```{r,  warning = FALSE, message = FALSE } 

fit2 <- lm(mpg ~ cyl + disp + wt + qsec + am, mtcars)
summary(fit2)

```
Based on this multivariate regression model, a manual transmission car has a fuel efficiency of 2.54 MPG higher than that of automatic transmission cars. The adjusted R^2 of the model is 0.826, meaning that 82% of the variance in mpg can be explained by the model.

#### *3rd Model*

```{r,  warning = FALSE, message = FALSE } 

fit3 <- lm(mpg ~ ., mtcars)
summary(fit3)

```
Based on this multivariate regression model, a manual transmission car has a fuel efficiency of 2.94 MPG higher than that of automatic transmission cars. The adjusted R^2 of the model is 0.8165, meaning that 81.5% of the variance in mpg can be explained by the model.

#### *Evaluating The Models*

```{r,  warning = FALSE, message = FALSE } 

anova(fit, fit2, fit3)

```

The p-values are highs. Which means that the best model is the first one, and also means that the weight, acceleration and transmission of the car have a significant impact on it’s MPG. 


## **Residuals**

```{r,  warning = FALSE, message = FALSE } 
r <- resid(fit)

d <- density(r) 

plot(d)
```

The residuals are normally distributed.


```{r,  warning = FALSE, message = FALSE } 
par(mfrow=c(2,2))
plot(fit, 1)
plot(fit, 2)
plot(fit, 3)
plot(fit, 5)
```

We have some outliers in the dataset, but they don't have high leverage or influence. So we don't need to omit them.


## **Conclusion**

To conclude, we assume that there is a significant association between Miles Per Galon and Transmission, and a manual transmission car has a fuel efficiency of 2.54 MPG higher than that of automatic transmission cars.

